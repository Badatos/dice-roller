<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--Google Fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&amp;display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- W3.org ARIA CheckboxMixed -->
  <link rel="stylesheet" type="text/css" href="../../../css/CheckboxMixed.css" />

  <!-- Search box w. icon-->
  <link rel="stylesheet" type="text/css" href="../../../css/search-input.css" />

  <link rel="stylesheet" type="text/css" href="../../shaan.css" />
  <link rel="stylesheet" type="text/css" href="../../compendium/compendium.css" />

  <title>Liste des acquis - Shaan Renaissance</title>
</head>

<body>

  <div class="container shaan-title red fixed-top" id="header">
    <h1>Liste des acquis - Shaan Renaissance</h1>
  </div>
  <main class="container mt-5 pt-5">
    <nav aria-label="Fil d’ariane" class="ms-5">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../../">Aides de Jeu</a></li>
        <li class="breadcrumb-item"><a href="../../">Shaan</a></li>
        <li class="breadcrumb-item active" aria-current="page">Acquis</li>
      </ol>
    </nav>
    <div class="accordion d-print-none" id="accordionFilters">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
            aria-expanded="true" aria-controls="collapseOne">
            Filtres
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="intro mb-2">
              Cet outil en ligne permet de lister et de filtrer tous les acquis
              de Shaan Renaissance grâce à plusieurs options.
              <!-- TODO -->
              <!--Vous pouvez trier la liste comme vous le souhaitez.-->
              <!--Vous pouvez également sélectionner certains résultats
              pour générer votre propre liste d'acquis.-->
            </div>
            <form name="filtres">
              <div class="row">
                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Caste</legend>
                  <label class="form-check-label" for="selectAllDomains">
                    <input type="checkbox" id="selectAllDomains" checked="checked" class="form-check-input">
                    Toutes les castes
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="domain" class="form-select"
                    aria-describedby="domain-help"
                    multiple>
                    <option value="Novateur"
                            selected="selected"
                            title="Ceux qui travaillent cuir, métal, pierre, bois, verre, tissu, ainsi que la technologie humaine">
                            Novateur
                    </option>
                    <option value="Érudit"
                            selected="selected"
                            title="L'élite intellectuelle de la population héossienne">
                            Érudit
                    </option>
                    <option value="Négociant"
                            selected="selected"
                            title="Ceux qui tissent des liens sociaux, que ce soit à but lucratif ou par intérêt politique">
                            Négociant
                    </option>
                    <option value="Artiste"
                            selected="selected"
                            title="Ceux dont le but est de divertir la population">
                            Artiste
                    </option>
                    <option value="Shaaniste"
                            selected="selected"
                            title="Les porteurs de lumière">
                            Shaaniste
                    </option>
                    <option value="Magicien"
                            selected="selected"
                            title="Ils utilisent les Trihns qui voyagent sur Héos comme combustible pour leurs pouvoirs">
                            Magicien
                    </option>
                    <option value="Élémentaliste"
                            selected="selected"
                            title="Ils vouent un culte aux Éléments">
                            Élémentaliste
                    </option>
                    <option value="Voyageur"
                            selected="selected"
                            title="Ceux chargés de transporter quelque chose ou quelqu'un d'un point à un autre">
                            Voyageur
                    </option>
                    <option value="Combattant"
                            selected="selected"
                            title="Ceux qui ne vivent que par la guerre et le respect de l'ordre">
                            Combattant
                    </option>
                    <option value="Ombre"
                            selected="selected"
                            title="Ceux qui imposent leur autorité par La peur">
                            Ombres
                    </option>
                    <option value="Saren"
                            selected="selected"
                            title="La race disparue">
                            Saren
                    </option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3">
                  <legend>Classe</legend>
                  <label for="nivMin" class="form-label">Classe Minimum</label>
                  <select name="nivMin" id="nivMin" class="form-select">
                    <option value="0" selected="selected">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                  </select>
                  <label for="nivMax" class="form-label">Classe Maximum</label>
                  <select name="nivMax" id="nivMax" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected="selected">5</option>
                  </select>
                </fieldset>

                <!--fieldset class="col checkbox-mixed">
                  <legend>Affichage</legend>
                  <label for="allC">
                    <input type="checkbox" id="allC" class="form-check-input check-all"
                      aria-controls="cond1 cond2 cond3 cond4">
                    Toutes les propriétés
                  </label>
                  <ul class="checkboxes">
                    <li>
                      <label class="form-check-label">
                        <input type="checkbox" id="cond2" checked="" class="form-check-input">
                        Tomato
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond3" class="form-check-input">
                        Mustard
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond4" class="form-check-input">
                        Sprouts
                      </label>
                    </li>
                  </ul>
                </fieldset-->
              </div>

              <div class="row mt-2">
                <input type="submit" name="filtrer"
                  class="btn btn-primary btn-block"
                  value="Filtrer">
                <div class="col-sm-4 col-md-2">
                  <!--a href="#pied" title="PIED" class="btn btn-link">
                    <i class="bi bi-arrow-down-circle" title="Bottom"></i>
                  </a-->
                  <!--a onclick="reset()" class="btn-link btn">
                    <i class="bi bi-arrow-repeat" title="Reset"></i>
                  </a-->
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2"
            aria-expanded="true" aria-controls="collapse2">
            Recherche
          </button>
        </h2>
        <div id="collapse2" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="col">
              <div class="search-container">
                <input id="search" type="text" class="form-control search-input"
                aria-describedby="search-help"
                  placeholder="Rechercher...">
                <i class="bi bi-search search-icon"></i>
              </div>
              <!--a onclick="clearFilter()" class="btn-link btn">
                <i class="bi bi-x"></i>
              </a-->
              <div id="search-help" class="form-text">Tapez au moins 3 caractères pour chercher un acquis dans les résultats ci-dessous.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <p class="text-end"><strong id="total"></strong> <span id="text-found">acquis trouvés.</span></p>
    <div class="row" id="liste-elements"></div>
    <pre id="code"></pre>
  </main>
  <footer class="container-fluid text-bg-dark text-center mt-5 pt-2 pb-1">
    <p>Vous avez trouvé un bug ou une erreur ? <a href="https://github.com/Badatos/dice-roller/issues">Signaler un
        bug</a></p>
    <p>Pour en savoir plus sur le jeu de rôle <strong>Shaan</strong>, rendez-vous sur<br>
      <a href="https://www.shaan-rpg.com">www.shaan-rpg.com</a>
      et <a href="https://www.shaan-world.com">www.shaan-world.com</a>
    </p>
  </footer>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js "></script>

  <!-- W3.org ARIA CheckboxMixed -->
  <script src="../../../js/indeterminate_checkboxes.js"></script>

  <!-- mustache.js - Logic-less {{mustache}} templates with JavaScript -->
  <script src="https://unpkg.com/mustache@latest"></script>

  <!--
  GsheetParser
  See doc at https://github.com/fureweb-com/public-google-sheets-parser#readme
  -->
  <script src="https://cdn.jsdelivr.net/npm/public-google-sheets-parser@latest"></script>
  <script>
    const options = { sheetName: 'Acquis', useFormat: false }
    const parser = new PublicGoogleSheetsParser(
      '1tC10OMJe0BOzZauCmqLxL7-D9KlWT13vswGDBJWySLc',
      options
    );
    const precode = document.getElementById("code");
    const bloc_pouvoirs = document.getElementById("liste-elements");
    const bloc_total = document.getElementById("total");
    const text_found = document.getElementById("text-found");

    let liste_pouvoirs = [];

    parser.parse().then(data => {
      liste_pouvoirs = data;
      display_pouvoirs(data);
      bloc_total.textContent = data.length;
    });

    function display_pouvoirs(data) {
      fetch("../../templates/acquis.mustache")
        .then((response) => response.text())
        .then((template) => {
          let renderedHTML = '';
          data.forEach(row => {
            if (
              row["Catégorie"] && (
                row["Catégorie"] == "Protection" ||
                row["Catégorie"].startsWith("Transport")
              )
            ) {
              row["Attributs"] = row["Spécialisation"];
              row["Spécialisation"] = "";
            }
            renderedHTML += Mustache.render(template, row);
            //precode.textContent += JSON.stringify(row, null, 2) + '\n';
          });
          bloc_pouvoirs.innerHTML = renderedHTML;
          search_filter();
        });
    }

  </script>

  <script>

  var filteredData = [];

  document.getElementById("search").addEventListener("keyup", function (event) {
    search_filter();
  });

  document.forms["filtres"].addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent the default form submission behavior

    const form = event.target;
    let selectedDomains = Array.from(form.domain.selectedOptions).map(option => option.value.toLowerCase());
    const minClass = parseInt(form.nivMin.value, 10);
    const maxClass = parseInt(form.nivMax.value, 10);

    filteredData = liste_pouvoirs.filter(item => {
      const itemClass = parseInt(romanNumber(item["Rang"]), 10);
      let itemDomain = item["Domaine"];
      if (itemDomain) {
        itemDomain = itemDomain.toLowerCase();
      }
      return (
        (selectedDomains.length === 0 || selectedDomains.includes(itemDomain)) &&
        (!isNaN(itemClass) && itemClass >= minClass && itemClass <= maxClass)
      );
    });
    if (selectedDomains.length > 9) {
      selectedDomains = "toutes castes";
    }
    bloc_total.textContent = filteredData.length;
    text_found.textContent = "acquis de " + selectedDomains +
      " de classe " + minClass;
    if (maxClass != minClass) {
      text_found.textContent += " à " + maxClass;
    }

    text_found.textContent += " trouvé(s).";
    display_pouvoirs(filteredData);
  });

  </script>

  <!-- Shaan template JS -->
  <script src="../../shaan.js"></script>
</body>

</html>