<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--Google Fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&amp;display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- W3.org ARIA CheckboxMixed -->
  <link rel="stylesheet" type="text/css" href="../../../css/CheckboxMixed.css" />

  <!-- Search box w. icon-->
  <link rel="stylesheet" type="text/css" href="../../../css/search-input.css" />

  <link rel="stylesheet" type="text/css" href="../../shaan.css" />
  <link rel="stylesheet" type="text/css" href="../../compendium/compendium.css" />

  <title>Liste des acquis - Shaan Renaissance</title>
</head>

<body>

  <div class="container shaan-title red fixed-top" id="header">
    <h1>Liste des acquis - Shaan Renaissance</h1>
  </div>
  <main class="container mt-5 pt-5">
    <nav aria-label="Fil d’ariane" class="ms-5">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../../">Aides de Jeu</a></li>
        <li class="breadcrumb-item"><a href="../../">Shaan</a></li>
        <li class="breadcrumb-item active" aria-current="page">Acquis</li>
      </ol>
    </nav>

    <div class="accordion d-print-none" id="accordionFilters">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
            aria-expanded="true" aria-controls="collapseOne">
            Filtres
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="intro mb-2">
              Cet outil en ligne permet de lister et de filtrer tous les acquis
              de Shaan Renaissance grâce à plusieurs options.
              <!-- TODO -->
              <!--Vous pouvez trier la liste comme vous le souhaitez.-->
              <!--Vous pouvez également sélectionner certains résultats
              pour générer votre propre liste d'acquis.-->
            </div>
            <form name="filtres">
              <div class="row">
                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Caste</legend>
                  <label class="form-check-label" for="selectAllDomains">
                    <input type="checkbox" id="selectAllDomains" checked="checked" class="form-check-input">
                    Toutes les castes
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="domain" class="form-select"
                    multiple>
                    <option value="Novateur"
                            selected="selected"
                            title="Ceux qui travaillent cuir, métal, pierre, bois, verre, tissu, ainsi que la technologie humaine">
                            Novateur
                    </option>
                    <option value="Érudit"
                            selected="selected"
                            title="L'élite intellectuelle de la population héossienne">
                            Érudit
                    </option>
                    <option value="Négociant"
                            selected="selected"
                            title="Ceux qui tissent des liens sociaux, que ce soit à but lucratif ou par intérêt politique">
                            Négociant
                    </option>
                    <option value="Artiste"
                            selected="selected"
                            title="Ceux dont le but est de divertir la population">
                            Artiste
                    </option>
                    <option value="Shaaniste"
                            selected="selected"
                            title="Les porteurs de lumière">
                            Shaaniste
                    </option>
                    <option value="Magicien"
                            selected="selected"
                            title="Ils utilisent les Trihns qui voyagent sur Héos comme combustible pour leurs pouvoirs">
                            Magicien
                    </option>
                    <option value="Élémentaliste"
                            selected="selected"
                            title="Ils vouent un culte aux Éléments">
                            Élémentaliste
                    </option>
                    <option value="Voyageur"
                            selected="selected"
                            title="Ceux chargés de transporter quelque chose ou quelqu'un d'un point à un autre">
                            Voyageur
                    </option>
                    <option value="Combattant"
                            selected="selected"
                            title="Ceux qui ne vivent que par la guerre et le respect de l'ordre">
                            Combattant
                    </option>
                    <option value="Ombre"
                            selected="selected"
                            title="Ceux qui imposent leur autorité par La peur">
                            Ombres
                    </option>
                    <option value="Saren"
                            selected="selected"
                            title="La race disparue">
                            Saren
                    </option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3">
                  <legend>Classe</legend>
                  <label for="nivMin" class="form-label">Classe Minimum</label>
                  <select name="nivMin" id="nivMin" class="form-select">
                    <option value="0" selected="selected">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                  </select>
                  <label for="nivMax" class="form-label">Classe Maximum</label>
                  <select name="nivMax" id="nivMax" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5" selected="selected">5</option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Catégorie</legend>
                  <label class="form-check-label" for="selectAllCats">
                    <input type="checkbox" id="selectAllCats" checked="checked" class="form-check-input">
                    Toutes les catégories
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="categorie" class="form-select"
                    multiple>
                    <option value="Bâtiment" selected="selected">Bâtiment</option>
                    <option value="Technologie" selected="selected">Technologie</option>
                    <option value="Manuscrit" selected="selected">Manusccrit</option>
                    <option value="Armement" selected="selected">Armemement</option>
                    <option value="Outil" selected="selected">Outil</option>
                    <option value="Relation" selected="selected">Relation</option>
                    <option value="Artefact" selected="selected">Artefact</option>
                    <option value="Transport" selected="selected">Transport</option>
                    <option value="Armimale" selected="selected">Armimale</option>
                    <option value="Richesse" selected="selected">Richesse</option>
                    <option value="Protection" selected="selected">Protection</option>
                    <option value="Altération" selected="selected">Altération</option>
                    <option value="Attaque" selected="selected">Attaque</option>
                    <option value="Communication" selected="selected">Communication</option>
                    <option value="Contrôle" selected="selected">Contrôle</option>
                    <option value="Morphe" selected="selected">Morphe</option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Source</legend>
                  <label class="form-check-label" for="selectAllSrc">
                    <input type="checkbox" id="selectAllSrc" checked="checked" class="form-check-input">
                    Toutes les sources
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="source" class="form-select" multiple>
                    <option value="Manuel d’itinérance" selected="selected">Manuel d'itinérance</option>
                    <option value="L’erreur est humaine" selected="selected">L'erreur est humaine</option>
                  </select>
                </fieldset>

                <!--fieldset class="col checkbox-mixed">
                  <legend>Affichage</legend>
                  <label for="allC">
                    <input type="checkbox" id="allC" class="form-check-input check-all"
                      aria-controls="cond1 cond2 cond3 cond4">
                    Toutes les propriétés
                  </label>
                  <ul class="checkboxes">
                    <li>
                      <label class="form-check-label">
                        <input type="checkbox" id="cond2" checked="" class="form-check-input">
                        Tomato
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond3" class="form-check-input">
                        Mustard
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond4" class="form-check-input">
                        Sprouts
                      </label>
                    </li>
                  </ul>
                </fieldset-->
              </div>

              <div class="row mt-2">
                <input type="submit" name="filtrer"
                  class="btn btn-primary btn-block"
                  value="Filtrer">
                <div class="col-sm-4 col-md-2">
                  <!--a onclick="reset()" class="btn-link btn">
                    <i class="bi bi-arrow-repeat" title="Reset"></i>
                  </a-->
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2"
            aria-expanded="true" aria-controls="collapse2">
            Recherche
          </button>
        </h2>
        <div id="collapse2" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="col">
              <div class="search-container">
                <input id="search" type="text" class="form-control search-input"
                aria-describedby="search-help"
                  placeholder="Rechercher…">
                <i class="bi bi-search search-icon"></i>
              </div>
              <!--a onclick="clearFilter()" class="btn-link btn">
                <i class="bi bi-x"></i>
              </a-->
              <div id="search-help" class="form-text">Tapez au moins 3 caractères pour chercher un acquis dans les résultats ci-dessous.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <a href="#pied" title="Bas de page" class="btn btn-link">
      <i class="bi bi-arrow-down-circle" aria-hidden="true"></i>
    </a>

    <div class="text-center" id="loader">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Chargement…</span>
      </div>
    </div>

    <div class="table-responsive d-print-none">
      <table class="table table-striped caption-top sortable" id="table-elements">
        <caption>
          <strong id="total">0</strong>
          <span id="text-found">acquis trouvés.</span>
        </caption>
        <thead>
          <tr>
            <th scope="col"><span class="visually-hidden">Sélection</span></th>
            <th scope="col">Acquis</th>
            <th scope="col">Caste</th>
            <th scope="col">Rang</th>
            <th scope="col">Catégorie</th>
            <th scope="col">Spécialisation</th>
            <!--th scope="col">Attributs</th>
            <th scope="col">Résumé</th>
            <th scope="col">Valeur</th>
            <th scope="col">Prestige</th>
            <th scope="col">Ressources</th>
            <th scope="col">Fabrication</th>
            <th scope="col">Dressage</th>
            <th scope="col">Entretien</th>
            <th scope="col">Détails</th-->
            <th scope="col">Source</th>
          </tr>
        </thead>
        <tbody id="liste-elements"> </tbody>
      </table>
    </div>

    <div id="foot_actions" class="mt-2 d-print-none">
      <div class="row">
        <!--div class="col">
          <input type="checkbox" class="form-check-input" id="selectAll" onclick="selectBox()">
          <label for="selectAll">Tout sélectionner</label>
        </div-->
        <!--fieldset class="col">
          <legend><i class="bi bi-printer" aria-hidden="true"></i> Format</legend>
          <input type="radio" class="form-check-input" name="type" value="C" id="type-C" checked="checked">
          <label class="form-check-label" for="type-C">Cartes</label>
        </fieldset-->
      </div>
      <div class="row" id="pied">
        <div class="col-sm-12">
          <a href="#table-elements" title="Haut de page" class="btn btn-link">
            <i class="bi bi-arrow-up-circle" aria-hidden="true"></i>
          </a>
          <!--
          <a class="btn btn-primary btn-block" onclick="generate(this, event)">Générer</a>
          <i class="bi bi-database"></i> <strong id="total-bas">XX</strong> acquis
        -->
          <i class="bi bi-file-pdf" title="Guide to generate a PDF from your browser:
              1) Select PRINT
              2) Change the destination to select PDF FORMAT instead of your current printer
              3) Ajust margin by selecting NO MARGIN or MINIMUM MARGIN
              4) You can also decide with the OPTIONS to print or not the background image"></i>
          <!--input type="submit" class="btn btn-secondary" name="save" value="Exporter"-->
        </div>
      </div>
    </div>

    <ul class="nav nav-pills justify-content-end d-print-none">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page"
           href="#table-elements" id="table-tab"
           onclick="table_switch(this, event)">
          <i class="bi bi-table"></i> Tableau
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#card-elements" id="card-tab"
           onclick="generate(this, event)">
          <i class="bi bi-postcard"></i> Cartes
        </a>
      </li>
    </ul>
    <div id="card-elements" class="row d-none mt-1"> </div>
  </main>
  <footer class="container-fluid text-bg-dark text-center mt-5 pt-2 pb-1">
    <p>Vous avez trouvé un bug ou une erreur ? <a href="https://github.com/Badatos/dice-roller/issues">Signaler un
        bug</a></p>
    <p>Pour en savoir plus sur le jeu de rôle <strong>Shaan</strong>, rendez-vous sur<br>
      <a href="https://www.shaan-rpg.com">www.shaan-rpg.com</a>
      et <a href="https://www.shaan-world.com">www.shaan-world.com</a>
    </p>
  </footer>

  <div class="modal" tabindex="-1" id="item-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Aperçu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="items-list">
          <p>Modal body text goes here.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js "></script>

  <!-- W3.org ARIA CheckboxMixed -->
  <script src="../../../js/indeterminate_checkboxes.js"></script>

  <!-- mustache.js - Logic-less mustache templates with JavaScript -->
  <script src="https://unpkg.com/mustache@latest"></script>

  <!--
  GsheetParser
  See doc at https://github.com/fureweb-com/public-google-sheets-parser#readme
  -->
  <script src="https://cdn.jsdelivr.net/npm/public-google-sheets-parser@latest"></script>
  <script>

    const items_list = document.getElementById("items-list");
    const itemModal = new bootstrap.Modal(document.getElementById('item-modal'));
    const card_elements = document.getElementById("card-elements");
    const table_elements = document.getElementById("table-elements");

    const card_tab = document.getElementById("card-tab");
    const table_tab = document.getElementById("table-tab");

    const options = { sheetName: 'Acquis', useFormat: false }
    const parser = new PublicGoogleSheetsParser(
      '1tC10OMJe0BOzZauCmqLxL7-D9KlWT13vswGDBJWySLc',
      options
    );
    const liste_elements = document.getElementById("liste-elements");
    const bloc_total = document.getElementById("total");
    const text_found = document.getElementById("text-found");
    const loader = document.getElementById("loader");

    let liste_origine = [];
    var filteredData = ["VIDE"];

    parser.parse().then(data => {
      liste_origine = data;
      display_acquis(data);
      bloc_total.textContent = data.length;
    });

    function modal_acquis(item, event) {
      event.preventDefault();
      const selectedDatas = liste_origine.filter((o) => o.Acquis === item.dataset["name"]);
      display_acquis(selectedDatas, items_list, "acquis");
      itemModal.show();
    }

    function table_switch(elem, event) {
      if(event) {
        event.preventDefault();
      }
      if (!table_tab.classList.contains("active")) {
        card_elements.classList.add("d-none");
        card_tab.classList.remove("active");
        card_tab.removeAttribute('aria-current');
        table_elements.classList.remove("d-none");
        table_tab.classList.add("active");
        table_tab.setAttribute('aria-current', "page");
      }
    }

    function display_acquis(data, target=liste_elements, template="acquis_row") {
      fetch("../../templates/"+template+".mustache")
        .then((response) => response.text())
        .then((template) => {
          let renderedHTML = '';
          data.forEach(row => {
            if (
              row["Catégorie"] && (
                row["Catégorie"] == "Protection" ||
                row["Catégorie"].startsWith("Transport")
              )
            ) {
              row["Attributs"] = row["Spécialisation"];
              row["Spécialisation"] = "";
            }
            if (row["Rang"] && row["Rang"] === 0){
              row["Rang"] = "";
            }
            renderedHTML += Mustache.render(template, row);
          });
          target.innerHTML = renderedHTML;
          search_filter();
        });

    }


  document.getElementById("search").addEventListener("keyup", function (event) {
    loader.classList.remove("d-none");
    liste_elements.classList.add("d-none");
    search_filter();
  });

  document.forms["filtres"].addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent the default form submission behavior

    loader.classList.remove("d-none");
    liste_elements.classList.add("d-none");
    const form = event.target;
    const selectedDomain = Array.from(form.domain.selectedOptions).map(option => option.value.toLowerCase());
    const selectedCat = Array.from(form.categorie.selectedOptions).map(option => option.value.toLowerCase());
    const selectedSource = Array.from(form.source.selectedOptions).map(option => option.value.toLowerCase());
    const minClass = parseInt(form.nivMin.value, 10);
    const maxClass = parseInt(form.nivMax.value, 10);

    const ignoreDomain = selectedDomain.length === 0 || selectedDomain.length === form.domain.options.length;
    const ignoreCat = selectedCat.length === 0 || selectedCat.length === form.categorie.options.length;
    const ignoreSource = selectedSource.length === 0 || selectedSource.length === form.source.options.length;

    filteredData = liste_origine.filter(item => {
      const itemClass = romanNumber(item["Rang"]);
      let itemDomain = item["Domaine"]?item["Domaine"].toLowerCase():"";

      let itemCategorie = item["Catégorie"]?item["Catégorie"].toLowerCase():"";
      itemCategorie = itemCategorie.split(" ")[0];
      // console.log(itemCategorie);

      let itemSource = item["Source"];
      if (itemSource) {
        itemSource = itemSource.toLowerCase().split(",")[0].split("'")
        itemSource = itemSource[itemSource.length - 1];
        // console.log(itemSource);
      }

      return (
        (ignoreDomain || selectedDomain.includes(itemDomain)) &&
        (!isNaN(itemClass) && itemClass >= minClass && itemClass <= maxClass) &&
        (ignoreCat || selectedCat.includes(itemCategorie)) &&
        (ignoreSource || selectedSource.includes(itemSource))
      );
    });
    bloc_total.textContent = filteredData.length;
    text_found.textContent = "acquis"
    if (!ignoreDomain) {
      text_found.textContent += " de " + selectedDomain;
    }
    if (!ignoreCat) {
      text_found.textContent += " de type " + selectedCat;
    }

    text_found.textContent +=  " de classe " + minClass;
    if (maxClass != minClass) {
      text_found.textContent += " à " + maxClass;
    }

    text_found.textContent += " trouvé(s)";
    if (!ignoreSource) {
      text_found.textContent += " dans " + selectedSource;
    }
    text_found.textContent += ".";
    display_acquis(filteredData);
    table_switch(null, null);
  });

  </script>

  <!-- https://github.com/tofsjonas/sortable -->
  <link href="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/dist/sortable.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/dist/sortable.min.js"></script>

  <!-- Shaan template JS -->
  <script src="../../shaan.js"></script>
</body>

</html>