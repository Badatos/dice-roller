<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--Google Fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&amp;display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    rel="stylesheet" crossorigin="anonymous">

  <!-- W3.org ARIA CheckboxMixed -->
  <link rel="stylesheet" type="text/css" href="../../css/CheckboxMixed.css" />

  <link rel="stylesheet" type="text/css" href="../shaan.css" />
  <link rel="stylesheet" type="text/css" href="../compendium/compendium.css" />
  <title>Créateur de personnage - Shaan World</title>
  <style>
    .label-icon {
      background-repeat: no-repeat;
      background-size: 1.2em;
      padding-left: 1.3em;
      background-position-y: center;
    }
  </style>
</head>

<body>
  <div class="container shaan-title blue fixed-top" id="header">
    <h1>Character Creator</h1>
  </div>
  <main class="container mt-5 pt-5">

    <nav aria-label="Fil d’ariane" class="ms-3 pt-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../">Aides de Jeu</a></li>
        <li class="breadcrumb-item"><a href="../">Shaan</a></li>
        <li class="breadcrumb-item"><a href="../">World</a></li>
        <li class="breadcrumb-item active" aria-current="page">Créateur de personnage</li>
      </ol>
    </nav>
    <div class="row">
      <form class="col-md-6 d-print-none" id="acq-generator">
        <div class="row mb-3">
          <div class="col-sm-12 col-md-6  col-lg-4 mb-3">
            <label for="name" class="form-label">Nom du personnage</label>
            <input type="text" class="form-control" id="name" value="Inconnu Anonyme" required>
          </div>
          <div class="col-sm-12 col-md-6  col-lg-4 mb-3">
            <label for="gender" class="form-label">Genre</label>
            <select id="gender" class="form-select">
              <option value="masculin">Masculin</option>
              <option value="féminin">Féminin</option>
              <option value="neutre">Neutre</option>
            </select>
          </div>
          <div class="col-sm-12 col-md-6  col-lg-4 mb-3">
            <label for="image" class="form-label">Avatar</label>
            <input type="text" class="form-control" id="image" aria-describedby="image-help"
            value="https://www.shaan-rpg.com/class-shaan/img/avatar/avatar_default.jpg">
            <div id="image-help" class="form-text">URL d’une image d’illustration.</div>
          </div>
        </div>

        <div class="accordion" id="characterSteps">
          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-1"
                aria-expanded="true" aria-controls="collapse-1">
                01. Lignée
              </button>
            </h2>
            <div id="collapse-1" class="accordion-collapse collapse show" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <select id="lignee" name="lignee" class="form-select">
                  <option value="">Choisis une lignée</option>
                </select>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-2"
                aria-expanded="false" aria-controls="collapse-2">
                02. Peuple
              </button>
            </h2>
            <div id="collapse-2" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <select id="people" name="people" class="form-select">
                  <option value="">Choisis un peuple</option>
                </select>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-3"
                aria-expanded="false" aria-controls="collapse-3">
                03. Archétype
              </button>
            </h2>
            <div id="collapse-3" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <label for="domain" class="form-label">Archétype</label>
                <select id="domain" name="domain" class="form-select">
                  <option value="">Choisis un archétype</option>
                  <option value="Technicien"
                          title="Le Technicien incarne l'alliance entre expertise, habileté manuelle et maîtrise des matériaux.">
                          Technicien
                  </option>
                  <option value="Savant"
                          title="Le Savant incarne la soif insatiable de connaissances, fusionnant mémoire, intellect et analyse.">
                          Savant
                  </option>
                  <option value="Médiateur"
                          title="Le Médiateur met en lumière la dimension relationnelle avec les autres individus, mettant en avant l'éloquence, l'art de l'articulation et de la séduction.">
                          Médiateur
                  </option>
                  <option value="Artiste"
                          title="L'Artiste incarne l'expression de la fibre artistique, de la sensualité et de la créativité. Musiciens, peintres, cuisiniers, danseurs et autres créateurs savent manier les émotions pour en tirer profit.">
                          Artiste
                  </option>
                  <option value="Shaaniste"
                          title="Le Shaaniste incarne la quête d'harmonie avec l'environnement, le magnétisme et la chance brute, définissant ainsi la lutte contre les Limbes pour instaurer le règne de la paix et de l'équilibre.">
                          Shaaniste
                  </option>
                  <option value="Mage"
                          title="Le Magicien, véritable virtuose des facultés magiques, possède le pouvoir de déceler et contrôler les flux d'énergie.">
                          Mage
                  </option>
                  <option value="Croyant"
                          title="Le Croyant incarne la foi inébranlable envers les éléments, démontrant la capacité à manipuler leur énergie primale pour s'approprier leurs facultés.">
                          Croyant
                  </option>
                  <option value="Aventurier"
                          title="L'Aventurier incarne l'union harmonieuse des capacités de déplacement, de perception et d'adaptation à un environnement naturel.">
                          Aventurier
                  </option>
                  <option value="Guerrier"
                          title="Le Guerrier s'impose dans toute confrontation physique, surtout lorsqu'il s'agit de manier une arme non technologique.">
                          Guerrier
                  </option>
                  <option value="Déviant"
                          title="Le Déviant personnifie le côté obscur, le cheminement du personnage sur la voie des Limbes.">
                          Déviant
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-4"
                aria-expanded="false" aria-controls="collapse-4">
                04. Vocations (x5)
              </button>
            </h2>
            <div id="collapse-4" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <label for="voca1" class="form-label">Vocation d'archétype</label>
                <select id="voca1" name="voca1" class="form-select">
                  <option value="">
                    Choisis d'abord un archétype
                  </option>
                </select>
                <!--label for="voca2" class="form-label">4 autres vocations</label>
                <select id="voca2" name="voca2" class="form-select"
                aria-describedby="voca2-help" multiple>
                  <option value="">
                    Choisis d'abord un archétype
                  </option>
                </select-->
                <fieldset class="mt-3">
                  <legend>4 autres vocations</legend>
                  <div id="voca2" class="grid">
                    <div class="form-text">Choisis d'abord une lignée, un peuple et un archétype</div>
                  </div>
                </fieldset>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-5"
                aria-expanded="false" aria-controls="collapse-5">
                05. Pouvoir
              </button>
            </h2>
            <div id="collapse-5" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow1" name="pouvoir">
                  <label class="form-check-label" for="pow1">
                    Eclair de génie
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow2" name="pouvoir">
                  <label class="form-check-label" for="pow2">
                    Osmose
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow3" name="pouvoir">
                  <label class="form-check-label" for="pow3">
                    Adaptation
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow4" name="pouvoir">
                  <label class="form-check-label" for="pow4">
                    Coup de chance
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow5" name="pouvoir">
                  <label class="form-check-label" for="pow5">
                    Second souffle
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow6" name="pouvoir">
                  <label class="form-check-label" for="pow6">
                    Clairvoyance
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="pow7" name="pouvoir">
                  <label class="form-check-label" for="pow7">
                    Anticipation
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-6"
                aria-expanded="false" aria-controls="collapse-6">
                06. Protections
              </button>
            </h2>
            <div id="collapse-6" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot1" name="pouvoir">
                  <label class="form-check-label" for="prot1">
                    Eclair de génie
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot2" name="pouvoir">
                  <label class="form-check-label" for="prot2">
                    Osmose
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot3" name="pouvoir">
                  <label class="form-check-label" for="prot3">
                    Adaptation
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot4" name="pouvoir">
                  <label class="form-check-label" for="prot4">
                    Coup de chance
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot5" name="pouvoir">
                  <label class="form-check-label" for="prot5">
                    Second souffle
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot6" name="pouvoir">
                  <label class="form-check-label" for="prot6">
                    Clairvoyance
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="prot7" name="pouvoir">
                  <label class="form-check-label" for="prot7">
                    Anticipation
                  </label>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item vert">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-7"
                aria-expanded="false" aria-controls="collapse-7">
                07. Equipement
              </button>
            </h2>
            <div id="collapse-7" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-8"
                aria-expanded="false" aria-controls="collapse-8">
                08. Origines
              </button>
            </h2>
            <div id="collapse-8" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-9"
                aria-expanded="false" aria-controls="collapse-9">
                09. Tempérament
              </button>
            </h2>
            <div id="collapse-9" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-10"
                aria-expanded="false" aria-controls="collapse-10">
                10. Rupture
              </button>
            </h2>
            <div id="collapse-10" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-11"
                aria-expanded="false" aria-controls="collapse-11">
                11. Vécu
              </button>
            </h2>
            <div id="collapse-11" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-12"
                aria-expanded="false" aria-controls="collapse-12">
                12. Rôle
              </button>
            </h2>
            <div id="collapse-12" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>

          <div class="accordion-item bleu">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse" data-bs-target="#collapse-13"
                aria-expanded="false" aria-controls="collapse-13">
                13. Quête
              </button>
            </h2>
            <div id="collapse-13" class="accordion-collapse collapse" data-bs-parent="#characterSteps">
              <div class="accordion-body">
                <p>Choisis d'abord lignée, peuple et case.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="mb-3 d-none">
          <label for="desc" class="form-label">Description</label>
          <textarea class="form-control" id="desc" aria-describedby="desc-help" rows="6">
Cet acquis est *super*.

### Capacités

* **Protection** : Défense de Corps +1
          </textarea>
          <div id="desc-help" class="form-text">
            Décris ton acquis et ses éventuelles capacités
            (<a href="https://docs.framasoft.org/fr/grav/markdown.html" target="_blank">format Markdown</a>).</div>
        </div>
      </form>

      <div id="result" class="col-md-6">
        <div id="fiche-perso" class="sticky-top pt-4"></div>
      </div>
    </div>
  </main>

  <footer class="container-fluid text-bg-dark text-center mt-5 pt-2 pb-1">
    <p>Pour en savoir plus sur le jeu de rôle <strong>Shaan Renaissance</strong>,
      rendez-vous sur
      <a
    href="https://www.shaan-rpg.com">www.shaan-rpg.com</a>.
    </p>
  </footer>
  <!-- mustache.js - Logic-less {{mustache}} templates with JavaScript -->
  <script src="https://unpkg.com/mustache@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!--
  GsheetParser
  See doc at https://github.com/fureweb-com/public-google-sheets-parser#readme
  -->
  <script src="https://cdn.jsdelivr.net/npm/public-google-sheets-parser@latest"></script>

  <script>

    let cercle_tpl;
    fetch("../templates/cercle.mustache")
    .then((response) => response.text())
    .then((template) => {
      cercle_tpl = template;
    });

    let form_check;
    fetch("../../templates/form_check.mustache")
    .then((response) => response.text())
    .then((template) => {
      form_check = template;
    });

    const acq_generator = document.getElementById("acq-generator");
    acq_generator.addEventListener("change", calcul_stats);


    const lignees = {
      "Chrysalis": {
        "Etre-plante": "Shaan",
        "Ygwan Ephémère": "Rituels",
        "Androïde Renégat": "Technique",
        "Feling Nocturne": "Nécrose",
        "Antéhumain": "Savoir"
      },
      "Héossie": {
        "Humain": "Nécrose",
        "Kelwin": "Technique",
        "Ygwan": "Savoir",
        "Delhion": "Social",
        "Mélodien": "Arts",
        "Feling": "Shaan",
        "Nomoï": "Magie",
        "Woon": "Rituels",
        "Boréal": "Survie",
        "Darken": "Combat"
      }
    };
    const peuples = {
      "Chrysalis": {
        "Forêts Primales": "Social",
        "Etendues Nomades": "Survie",
        "Monts Fleuris": "Arts",
        "Plaines Ardentes": "Combat",
        "Marécages": "Magie"
      },
      "Héossie": {
        "Cités": "Nécrose",
        "Terres Brûlées": "Technique",
        "Marais": "Savoir",
        "Montagnes": "Social",
        "Hautes Herbes": "Arts",
        "Grands Arbres": "Shaan",
        "Glaces": "Magie",
        "Forêts Blanches": "Rituels",
        "Rivages": "Survie",
        "Sables": "Combat"
      },
    };

    const vocations = {
      "Technicien": ["Mécaniste", "Récupérateur", "Artisan", "Pilote", "Codeur", "Biotek"],
      "Savant": ["Eminence grise", "Alchimiste", "Naturaliste", "Archéologue", "Archiviste", "Esotériste"],
      "Médiateur": ["Marchand", "Diplomate", "Séducteur", "Psychologue", "Informateur", "Prospecteur"],
      "Artiste": ["Evocateur", "Mélomane", "Comédien", "Cuisinier", "Saltimbanque", "Influenceur"],
      "Shaaniste": ["Biosophe", "Mentaliste", "Guérisseur", "Marcheur de rêve", "Prescient", "Purificateur"],
      "Mage": ["Mage onirique", "Sève-mage", "Changeforme", "Stellaire", "Solarien", "Sélenith", "Enchanteur", "Illusionniste", "Belliqueux"],
      "Croyant": ["Disciple du temps", "Disciple de la Lumière", "Druide", "Disciple de l'Air", "Disciple de l'Air"],
      "Aventurier": ["Chasseur", "Athlète", "Caravanier", "Espion", "Messager", "Explorateur"],
      "Guerrier": ["Gladiateur", "Barbare", "Tireur d'élite", "Stratège", "Protecteur", "Armimalier"],
      "Déviant": ["Voyou", "Trafiquant", "Mitrailleur", "Nécromant", "Généticien", "Executeur"],
    };

    const CHRYSALIS_CORRESP = {
      "Chiffres": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
      "Vocations": ["Déviant", "Technicien", "Savant", "Médiateur", "Artiste", "Shaaniste", "Mage", "Croyant", "Aventurier", "Guerrier"],
      "Domaines": ["Nécrose", "Technique", "Savoir", "Social", "Arts", "Shaan", "Magie", "Rituels", "Survie", "Combat"],
    };

    const acq_name = document.getElementById("name");
    const image = document.getElementById("image");
    const desc = document.getElementById("desc");
    const pow_rank = document.getElementById("pow-rank");

    const voca1 = document.getElementById("voca1");
    const voca2_wrapper = document.getElementById("voca2");
    const voca2_input = document.getElementsByName("voca2");

    const ressources = document.getElementById("ressources");
    const specialisations = document.getElementById("specialisations");

    const calc_value = document.getElementById("acq-value");
    const calc_prestige = document.getElementById("acq-prestige");
    const calc_ress = document.getElementById("acq-ress");
    const calc_diff = document.getElementById("acq-diff");

    const carte_acquis = document.getElementById("fiche-perso");

    const bsCollapse = [];
    const inputListName = ["lignee", "people", "domain", "vocations", "pouvoir"];
    const inputList = [];
    const previous_values = {
      "lignee": "",
      "people": "",
      "domain": "",
    }
    for (let index = 1; index < 6; index++) {
      bsCollapse[index] = new bootstrap.Collapse("#collapse-"+index, {
        toggle: false
      });
      let name = inputListName[index-1];
      inputList[index] = document.getElementsByName(name)[0];

      if (name == "vocations") {
        voca1.addEventListener("change", voca_changed);
      } else {
        // Detect change on last input in tab
        inputList[index].addEventListener("change", function(event) {
          if(event.target.value !== "") {

            if (name == "domain") {
              // Clear existing options
              for (const option of voca1.querySelectorAll('option')) {
                option.remove();
              }
              let option = document.createElement('option');
              option.text = "Choisis ta vocation d'archétype";
              option.value = "";
              voca1.add(option, null);
              voca2_wrapper.innerHTML = "";

              // Vocation d'archétype
              vocations[event.target.value].forEach(element => {
                option = document.createElement('option');
                option.text = element + " +2";
                option.value = element;
                voca1.add(option, null);
              });
            }

            // Display next tab
            bsCollapse[index+1].show();
          }
        });
      }
    }

    // Remplit les sélecteurs par défaut
    document.addEventListener("DOMContentLoaded", function() {
      Object.keys(lignees.Chrysalis).forEach(element => {
        let option = document.createElement('option');
        option.text = option.value = element;
        lignee.add(option, null);
      });
      Object.keys(peuples.Chrysalis).forEach(element => {
        let option = document.createElement('option');
        option.text = option.value = element;
        people.add(option, null);
      });
    });

    function fill_vocations(type) {
      // On remplit les vocations en fonction de la lignée,
      // du peuple ou de l'archétype choisis
      if(type) {
        vocations[type].forEach(element => {
          index = CHRYSALIS_CORRESP.Vocations.indexOf(type);
          let color = "";
          switch (index) {
            case 0:
              color = "grey";
              break;
            case 1:
            case 2:
            case 3:
              color = "jaune";
              break;
            case 4:
            case 5:
            case 6:
              color = "bleu";
              break;
            case 7:
            case 8:
            case 9:
              color = "rouge";
              break;
            default:
              color = "black";
              break;
          }
          let icon = CHRYSALIS_CORRESP.Domaines[index].toLowerCase();
          data = {
            "id": element,
            "value": element,
            "name": "voca2",
            "label": element + " +1",
            "type": "checkbox",
            "onchange": "voca_changed()",
            "color": color + " label-icon " + icon,
          };
          voca2_wrapper.innerHTML += Mustache.render(form_check, data);
        });
      }
    }

    function calcul_stats() {
      let data = {};

      data["Nom"] = acq_name.value;
      if (people.value !== "") {
        data["Peuple"] = "des " + people.value;
      }
      data["Lignée"] = inputList[1].value;
      data["Archétype"] = inputList[3].value;

      data["Image"] = image.value;
      data["Détails"] = desc.value;
      data["width"] = "m-auto";
      const voca_sources = [];
      //TODO : vider voca2 que si changement dans voca_sources
      // Garder voca_sources en global et ne lancer fill_vocations que si changement
      // ou stocker les vocations cochées avant, et les recocher ensuite.
      if (previous_values.lignee !== lignee.value ||
        previous_values.people !== people.value ||
        previous_values.domain !== domain.value
      ) {
        voca2_wrapper.innerHTML = "";
        if (lignee.value) {
          previous_values.lignee = lignee.value;
          index = CHRYSALIS_CORRESP.Domaines.indexOf(lignees.Chrysalis[lignee.value]);
          voca_sources.push(CHRYSALIS_CORRESP.Vocations[index]);
          fill_vocations(CHRYSALIS_CORRESP.Vocations[index]);
        }
        if (people.value) {
          previous_values.people = people.value;
          index = CHRYSALIS_CORRESP.Domaines.indexOf(peuples.Chrysalis[people.value]);
          if (voca_sources.includes(index) === false) {
            voca_sources.push(CHRYSALIS_CORRESP.Vocations[index]);
            fill_vocations(CHRYSALIS_CORRESP.Vocations[index]);
          }

        }
        if (domain.value) {
          previous_values.domain = domain.value;
          if (voca_sources.includes(index) === false) {
            voca_sources.push(domain.value);
            fill_vocations(domain.value);
          }
        }
      }

      switch(inputList[3].options[inputList[3].selectedIndex].text.toUpperCase()) {
        case "TECHNICIEN":
          data["dom_type"] = "technique";
          break;
        case "SAVANT":
          data["dom_type"] = "savoir";
          break;
        case "MEDIATEUR":
          data["dom_type"] = "social";
          break;
        case "ARTISTE":
          data["dom_type"] = "arts";
          break;
        case "SHAANISTE":
          data["dom_type"] = "shaan";
          break;
        case "MAGE":
          data["dom_type"] = "magie";
          break;
        case "CROYANT":
          data["dom_type"] = "rituels";
          break;
        case "AVENTURIER":
          data["dom_type"] = "survie";
          break;
        case "GUERRIER":
          data["dom_type"] = "combat";
          break;
        case "DEVIANT":
          data["dom_type"] = "necrose";
          break;
        case "SAREN":
          data["dom_type"] = "saren";
          break;
        default:
          data["dom_type"] = data.Domaine;
      }

      data["voca1"] = acq_generator.elements["voca1"].value;
      const voca2 = getChecked(acq_generator.elements["voca2"]);
      // Ignore the primary vocation in vocation 2
      if (voca2) {
        data["voca2"] = voca2.filter(item => item !== data["voca1"]);
      }

      if (data["Spécialisation"] > 0) {
        if (specialisations.value) {
          data["Spécialisation"] = data["Spécialisation"] + " : " + specialisations.value;
        } else {
          data["Spécialisation"] = data["Spécialisation"] + " bonus à choisir.";
        }
      } else {
        data["Spécialisation"] = "";
      }

      fetch("../templates/perso.mustache")
      .then((response) => response.text())
      .then((template) => {
        carte_acquis.innerHTML = Mustache.render(template, data, {
            cercle: cercle_tpl
        });

        /*
        const details = document.getElementById("details");
        details.innerHTML =
          marked.parse(details.innerHTML);
        */
      });
    }

    // Vérifie que toutes les vocations ont été sélectionnées
    function voca_changed(event) {
      const voca1 = acq_generator.elements["voca1"].value;
      voca2_elem = acq_generator.elements["voca2"];
      const voca2 = getChecked(voca2_elem);
      if (voca2.length > 3) {
        Array.from(voca2_elem).filter(
          checkbox => !checkbox.checked).forEach(element => {
          element.disabled = true
        });
        if (voca1 !== "") {
          // Display next tab
          bsCollapse[5].show();
        }
      } else {
        // Reset disabled status
        Array.from(voca2_elem).filter(
          checkbox => !checkbox.checked).forEach(element => {
          element.disabled = false
        });
      }
    }

    /**
     * Get checked values of a RadioNodeList
     */
    function getChecked(field) {
      if (field) {
        return Array.from(field).filter(
        checkbox => checkbox.checked).map(
        check => check.value);
      }
    }
  </script>

  <div class="version small text-bg-light p-1 pt-0">v 0.1</div>

  <!-- Shaan template JS -->
  <!--script src="../shaan.js"></script-->

</body>
</html>
