<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--Google Fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Economica:ital,wght@0,400;0,700;1,400;1,700&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&amp;display=swap" rel="stylesheet">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    crossorigin="anonymous" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  <!-- W3.org ARIA CheckboxMixed -->
  <link rel="stylesheet" type="text/css" href="../../../css/CheckboxMixed.css" />

  <!-- Search box w. icon-->
  <link rel="stylesheet" type="text/css" href="../../../css/search-input.css" />

  <!-- Sortable table -->
  <link href="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/dist/sortable.min.css" rel="stylesheet" />

  <link rel="stylesheet" type="text/css" href="../../assets/dnd.css" />
  <!--link rel="stylesheet" type="text/css" href="../../../shaan/compendium/compendium.css" /-->

  <title>Sorts - DD5.5</title>
</head>

<body>
  <head>
    <h1 class="p-2">Liste des sorts - DD5.5</h1>
  </head>
  <main class="container">
    <nav aria-label="Fil d’ariane" class="ms-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../../">Aides de Jeu</a></li>
        <li class="breadcrumb-item"><a href="../../">DnD</a></li>
        <li class="breadcrumb-item active" aria-current="page">Sorts</li>
      </ol>
    </nav>

    <div class="accordion d-print-none" id="accordionFilters">
      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
            aria-expanded="true" aria-controls="collapseOne">
            Filtres
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="intro mb-2">
              Cet outil en ligne permet de lister et de filtrer tous les pouvoirs
              de Shaan Renaissance grâce à plusieurs options.
              <!-- TODO -->
              <!--Vous pouvez trier la liste comme vous le souhaitez.-->
              <!--Vous pouvez également sélectionner certains résultats
              pour générer votre propre liste.-->
            </div>
            <form name="filtres">
              <div class="row">
                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>École</legend>
                  <label class="form-check-label" for="selectAllDomains">
                    <input type="checkbox" id="selectAllDomains" checked="checked" class="form-check-input">
                    Toutes les écoles
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="domain" class="form-select" multiple>
                    <option value="abjuration"
                      selected="selected"
                      title="Protéger les autres">
                        Abjuration
                    </option>
                    <option value="Divination"
                      selected="selected"
                      title="Comprendre le passé, le présent et le futur">
                        Divination
                    </option>
                    <option value="enchantement"
                      selected="selected"
                      title="Séduire magiquement d’autres personnes et monstres">
                        Enchantement
                    </option>
                    <option value="evocation"
                      selected="selected"
                      title="L’art de la destruction par les arcanes">
                        Évocation
                    </option>
                    <option value="illusion"
                      selected="selected"
                      title="Éblouit les sens, embrouille l’esprit et trompe même les plus sages">
                        Illusion
                    </option>
                    <option value="invocation"
                      selected="selected"
                      title="Produire des objets et des créatures">
                        Invocation
                    </option>
                    <option value="necromancie"
                      selected="selected"
                      title="Les forces cosmiques de la vie et de la mort">
                        Nécromancie
                    </option>
                    <option value="transmutation"
                      selected="selected"
                      title="Modifier l’énergie et la matière">
                        Transmutation
                    </option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3">
                  <legend>Niveau</legend>
                  <label for="nivMin" class="form-label">Niveau Minimum</label>
                  <select name="nivMin" id="nivMin" class="form-select">
                    <option value="0" selected="selected">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                  </select>
                  <label for="nivMax" class="form-label">Niveau Maximum</label>
                  <select name="nivMax" id="nivMax" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9" selected="selected">9</option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Classe</legend>
                  <label class="form-check-label" for="selectAllClass">
                    <input type="checkbox" id="selectAllClass" checked="checked" class="form-check-input">
                    Toutes les classes
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="classe" class="form-select" multiple>
                    <option value="Barde" selected="selected"
                      title="Musicien, danseur et mage exaltant">Barde</option>
                    <option value="Clerc" selected="selected"
                      title="Prêtre tirant des miracles du pouvoir divin">Clerc</option>
                    <option value="Druide" selected="selected"
                      title="Prêtre de la nature primitive">Druide</option>
                    <option value="Ensorceleur" selected="selected"
                      title="Mage éblouissant, débordant de sorcellerie innée">Ensorceleur</option>
                    <option value="Magicien" selected="selected"
                      title="Mage érudit aux pouvoirs arcaniques">Magicien</option>
                    <option value="Occultiste" selected="selected"
                      title="Hermétiste galvanisé par un pacte d'outre-monde">Occultiste</option>
                    <option value="Paladin" selected="selected"
                      title="Combattant vertueux sous serment sacré">Paladin</option>
                    <option value="Rôdeur" selected="selected"
                      title="Combattant itinérant, imprégné de magie primale">Rôdeur</option>
                  </select>
                </fieldset>

                <fieldset class="col-md-6 mb-3 checkbox-mixed">
                  <legend>Source</legend>
                  <label class="form-check-label" for="selectAllSrc">
                    <input type="checkbox" id="selectAllSrc" checked="checked" class="form-check-input">
                    Toutes les sources
                  </label>
                  <i class="bi bi-info-circle" title="Ctrl+Clic pour sélectionner plusieurs éléments"></i>

                  <select id="source" class="form-select" multiple>
                    <option value="PHB ’24" selected="selected">PHB ’24 (VO)</option>
                    <option value="PHB ’24 (BR)" selected="selected">PHB ’24 (BR)</option>
                    <option value="PHB ’24 (FR)" selected="selected">PHB ’24 (FR)</option>
                  </select>
                </fieldset>

                <!--fieldset class="col checkbox-mixed">
                  <legend>Affichage</legend>
                  <label for="allC">
                    <input type="checkbox" id="allC" class="form-check-input check-all"
                      aria-controls="cond1 cond2 cond3 cond4">
                    Toutes les propriétés
                  </label>
                  <ul class="checkboxes">
                    <li>
                      <label class="form-check-label">
                        <input type="checkbox" id="cond2" checked="" class="form-check-input">
                        Tomato
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond3" class="form-check-input">
                        Mustard
                      </label>
                    </li>
                    <li>
                      <label>
                        <input type="checkbox" id="cond4" class="form-check-input">
                        Sprouts
                      </label>
                    </li>
                  </ul>
                </fieldset-->
              </div>

              <div class="row mt-2">
                <input type="submit" name="filtrer"
                  class="btn btn-primary btn-block"
                  value="Filtrer">
                <div class="col-sm-4 col-md-2">
                  <!--a onclick="reset()" class="btn-link btn">
                    <i class="bi bi-arrow-repeat" title="Reset"></i>
                  </a-->
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="accordion-item">
        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2"
            aria-expanded="true" aria-controls="collapse2">
            Recherche
          </button>
        </h2>
        <div id="collapse2" class="accordion-collapse collapse show">
          <div class="accordion-body">
            <div class="col">
              <div class="search-container">
                <input id="search" type="text" class="form-control search-input"
                aria-describedby="search-help"
                  placeholder="Rechercher…">
                <i class="bi bi-search search-icon"></i>
              </div>
              <!--a onclick="clearFilter()" class="btn-link btn">
                <i class="bi bi-x"></i>
              </a-->
              <div id="search-help" class="form-text">Tapez au moins 3 caractères pour chercher un sort dans les résultats ci-dessous.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <a href="#pied" title="Bas de page"
       id="up" class="btn btn-link d-print-none">
      <i class="bi bi-arrow-down-circle" aria-hidden="true"></i>
    </a>

    <div class="text-center" id="loader">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Chargement…</span>
      </div>
    </div>

    <form name="selecteur" class="d-print-none" id="table-elements">
      <fieldset class="checkbox-mixed">
        <div class="table-responsive" style="max-height:30em">
          <table class="table table-striped caption-top sortable mb-0">
            <caption>
              <strong id="total">0</strong>
              <span id="text-found">sorts trouvés.</span>
            </caption>
            <thead class="sticky-top">
              <tr id="table-head">
                <th scope="col"><span class="visually-hidden">Sélection</span></th>
                <th scope="col">Nom</th>
                <th scope="col">École</th>
                <th scope="col">Niveau</th>
                <th scope="col">Incantation</th>
                <th scope="col">Matériel</th>
                <th scope="col">Rituel</th>
                <th scope="col">Concentration</th>
                <th scope="col">Source</th>
              </tr>
            </thead>
            <tbody id="liste-elements" class="checkboxes"> </tbody>
          </table>
        </div>
        <div class="col">
          <label for="selectAll">
            <input type="checkbox" class="form-check-input check-all"
              id="selectAll" onclick="selectAllItems()">
            Tout sélectionner
          </label>
        </div>
      </fieldset>
    </form>
    <pre id="code"></pre>

    <div id="card-elements" class="row d-none mt-1"> </div>

    <div id="foot_actions" class="mt-2 d-print-none">
      <div class="row">
        <!--fieldset class="col">
          <legend><i class="bi bi-printer" aria-hidden="true"></i> Format</legend>
          <input type="radio" class="form-check-input" name="type" value="C" id="type-C" checked="checked">
          <label class="form-check-label" for="type-C">Cartes</label>
        </fieldset-->
      </div>
      <div class="row" id="pied">
        <div class="col-sm-12">
          <a href="#up" title="Haut de page" class="btn btn-link">
            <i class="bi bi-arrow-up-circle" aria-hidden="true"></i>
          </a>
          <!--
          <a class="btn btn-primary btn-block" onclick="generate(this, event)">Générer</a>
          <i class="bi bi-database"></i> <strong id="total-bas">XX</strong> acquis
        -->
          <i class="bi bi-file-pdf" title="Guide to generate a PDF from your browser:
              1) Select PRINT
              2) Change the destination to select PDF FORMAT instead of your current printer
              3) Ajust margin by selecting NO MARGIN or MINIMUM MARGIN
              4) You can also decide with the OPTIONS to print or not the background image"></i>
          <!--input type="submit" class="btn btn-secondary" name="save" value="Exporter"-->
        </div>
      </div>
    </div>

    <ul class="nav nav-pills justify-content-end d-print-none">
      <li class="nav-item">
        <a class="nav-link active" aria-current="page"
           href="#table-elements" id="table-tab"
           onclick="table_switch(this, event)">
          <i class="bi bi-table"></i> Tableau
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#card-elements" id="card-tab"
           onclick="generate(this, event, 'spell')">
          <i class="bi bi-postcard"></i> Cartes
        </a>
      </li>
    </ul>

  </main>
  <footer class="container-fluid text-bg-dark text-center mt-5 pt-2 pb-1">
    <p>
      Pour en savoir plus sur le jeu de rôle <strong>DnD</strong>,
      rendez-vous sur<br>
      <a href="https://www.dndbeyond.com/">www.dndbeyond.com</a>
    </p>
  </footer>

  <div class="modal" tabindex="-1" id="item-modal">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Aperçu</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="items-list">
          <p>Modal body text goes here.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js "></script>

  <!-- W3.org ARIA CheckboxMixed -->
  <script src="../../../js/indeterminate_checkboxes.js"></script>

  <!-- mustache.js - Logic-less mustache templates with JavaScript -->
  <script src="https://unpkg.com/mustache@latest"></script>

  <!--
  GsheetParser
  See doc at https://github.com/fureweb-com/public-google-sheets-parser#readme
  -->
  <script src="https://cdn.jsdelivr.net/npm/public-google-sheets-parser@latest"></script>

  <script>

    const options = { sheetName: 'Sorts', useFormat: false }

    const precode = document.getElementById("code");

    let liste_sorts = [];

    function display_items(data, target="liste-elements", modele="spell_row") {

      liste_sorts = data;
      if(target=="liste-elements") {
        bloc_total.textContent = data.length;
      }
      const liste_elements = document.getElementById(target);
      fetch("../../templates/"+modele+".mustache")
      .then((response) => response.text())
      .then((template) => {
        let renderedHTML = '';
        liste_elements.innerHTML = "";
        data.forEach(row => {
          row["css_class"] = row.School.toLowerCase();
          row["css_class"] = row["css_class"].replace("é", "e");
          if(!row["Nom"]) {
            row["Nom"] = row["VO"] + " (VO)";
          }
          if(!row["Description"]) {
            row["Description"] = row["Desc_EN"];
          }
          if(!row["Matériel"]) {
            row["Matériel"] = row["Material_EN"];
          }
          if(row["Classes"] && typeof(row["Classes"]) == "string") {
            row["Classes"] = row["Classes"].split(",");
          }
          if(row["Classes"] && row["Classes"].length == 1) {
            row["Classes"] = row["Classes"][0].split("\n");
          }
          if(modele == "spell") {
            switch(row["Niveau"]) {
              case 0:
                row["Niveau"] = "mineur";
                break;
              case 1:
                row["Niveau"] = "du " + row["Niveau"] + "<sup>er</sup> niveau";
                break;
              default:
                row["Niveau"] = "du " + row["Niveau"] + "<sup>e</sup> niveau";
            }
          }
          renderedHTML += Mustache.render(template, row);
          loader.classList.add("d-none");
          //precode.textContent += JSON.stringify(row, null, 2) + '\n';
        });
        liste_elements.innerHTML = renderedHTML;
        search_filter();
      });
    }

  </script>
  <script src="../../../js/utils.js"></script>
  <script src="../compendium.js"></script>

  <!-- https://github.com/tofsjonas/sortable -->
  <script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/dist/sortable.min.js"></script>
  <!--script src="https://cdn.jsdelivr.net/gh/tofsjonas/sortable@latest/dist/sortable.a11y.min.js"></script-->

  <script>

    var filteredData = [];

    document.getElementById("search").addEventListener("keyup", function (event) {
      search_filter();
    });

    document.forms["filtres"].addEventListener("submit", function (event) {
      event.preventDefault(); // Prevent the default form submission behavior

      const form = event.target;
      const selectedSchool = Array.from(
        form.domain.selectedOptions).map(
          option => option.value.toLowerCase());
      const selectedClasses = Array.from(
        form.classe.selectedOptions).map(
          option => option.value.toLowerCase());
      const selectedSource = Array.from(
        form.source.selectedOptions).map(
          option => option.value.toLowerCase());

      const minLvl = parseInt(form.nivMin.value, 10);
      const maxLvl = parseInt(form.nivMax.value, 10);

      const ignoreSchool = selectedSchool.length === 0 || selectedSchool.length === form.domain.options.length;
      const ignoreClasses = selectedClasses.length === 0 || selectedClasses.length === form.classe.options.length;
      const ignoreSource = selectedSource.length === 0 || selectedSource.length === form.source.options.length;


      filteredData = liste_sorts.filter(item => {
        const itemLvl = item["Niveau"];
        let itemDomain = item["School"];
        if (itemDomain) {
          itemDomain = itemDomain.toLowerCase();
        }
        let itemClasses = item["Classes"];
        if (itemClasses && !Array.isArray(itemClasses)) {
          console.log(itemClasses);
          itemClasses = itemClasses.toLowerCase().split(",");
        }

        return (
          (ignoreSchool || selectedSchool.includes(itemDomain)) &&
          (ignoreClasses || hasAnySelectedList(selectedClasses, itemClasses)) &&
          (!isNaN(itemLvl) && itemLvl >= minLvl && itemLvl <= maxLvl)
        );
      });

      bloc_total.textContent = filteredData.length;
      text_found.textContent = "sorts ";
      if (!ignoreSchool) {
        if (selectedSchool.length === 1) {
          text_found.textContent += "de l’école " + selectedSchool
        } else if (selectedSchool.length === form.domain.options.length) {
          text_found.textContent += "de toutes écoles";
        } else {
          text_found.textContent += "des écoles " + selectedSchool;
        }
      }
      text_found.textContent += " de niveau " + minLvl;
      if (maxLvl != minLvl) {
        text_found.textContent += " à " + maxLvl;
      }

      text_found.textContent += " trouvé(s).";
      display_items(filteredData);
    });

    </script>
</body>

</html>